<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Data manipulation | Data exploration and statistics with R and the tidyverse</title>
  <meta name="description" content="Welcome to the wonderful world of data science and R !" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Data manipulation | Data exploration and statistics with R and the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Welcome to the wonderful world of data science and R !" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Data manipulation | Data exploration and statistics with R and the tidyverse" />
  
  <meta name="twitter:description" content="Welcome to the wonderful world of data science and R !" />
  

<meta name="author" content="Vivien Roussez (A1 Telekom Austria Group)" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro-r.html"/>
<link rel="next" href="stats.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data exploration and statistics with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Foreword</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#topics-of-the-week"><i class="fa fa-check"></i><b>2.1</b> Topics of the week</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#the-data-science-workflow"><i class="fa fa-check"></i><b>2.2</b> The data science workflow</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#about-the-interactions-with-other-colleagues"><i class="fa fa-check"></i><b>2.3</b> About the interactions with other colleagues</a></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#resources"><i class="fa fa-check"></i><b>2.4</b> Resources</a></li>
<li class="chapter" data-level="2.5" data-path="intro.html"><a href="intro.html#data-of-the-week"><i class="fa fa-check"></i><b>2.5</b> Data of the week</a></li>
<li class="chapter" data-level="2.6" data-path="intro.html"><a href="intro.html#your-mission"><i class="fa fa-check"></i><b>2.6</b> Your mission</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="intro-r.html"><a href="intro-r.html"><i class="fa fa-check"></i><b>3</b> Introduction to R</a><ul>
<li class="chapter" data-level="3.1" data-path="intro-r.html"><a href="intro-r.html#what-is-r"><i class="fa fa-check"></i><b>3.1</b> What is R</a><ul>
<li class="chapter" data-level="3.1.1" data-path="intro-r.html"><a href="intro-r.html#description"><i class="fa fa-check"></i><b>3.1.1</b> Description</a></li>
<li class="chapter" data-level="3.1.2" data-path="intro-r.html"><a href="intro-r.html#objective-comparison-with-pyhton"><i class="fa fa-check"></i><b>3.1.2</b> (Objective) comparison with Pyhton</a></li>
<li class="chapter" data-level="3.1.3" data-path="intro-r.html"><a href="intro-r.html#what-can-i-do-with-r"><i class="fa fa-check"></i><b>3.1.3</b> What can I do with R</a></li>
<li class="chapter" data-level="3.1.4" data-path="intro-r.html"><a href="intro-r.html#quick-presentation-of-the-ecosystem"><i class="fa fa-check"></i><b>3.1.4</b> Quick presentation of the ecosystem</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="intro-r.html"><a href="intro-r.html#basic-commands-to-know"><i class="fa fa-check"></i><b>3.2</b> Basic commands to know</a></li>
<li class="chapter" data-level="3.3" data-path="intro-r.html"><a href="intro-r.html#data-structures-in-r"><i class="fa fa-check"></i><b>3.3</b> Data structures in R</a><ul>
<li class="chapter" data-level="3.3.1" data-path="intro-r.html"><a href="intro-r.html#basic-data-structures"><i class="fa fa-check"></i><b>3.3.1</b> Basic data structures</a></li>
<li class="chapter" data-level="3.3.2" data-path="intro-r.html"><a href="intro-r.html#explore-a-new-data-structure-or-object"><i class="fa fa-check"></i><b>3.3.2</b> Explore a new data structure (or object)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="manip.html"><a href="manip.html"><i class="fa fa-check"></i><b>4</b> Data manipulation</a><ul>
<li class="chapter" data-level="4.1" data-path="manip.html"><a href="manip.html#import"><i class="fa fa-check"></i><b>4.1</b> Import</a><ul>
<li class="chapter" data-level="4.1.1" data-path="manip.html"><a href="manip.html#text-files"><i class="fa fa-check"></i><b>4.1.1</b> Text files</a></li>
<li class="chapter" data-level="4.1.2" data-path="manip.html"><a href="manip.html#excel-files"><i class="fa fa-check"></i><b>4.1.2</b> Excel files</a></li>
<li class="chapter" data-level="4.1.3" data-path="manip.html"><a href="manip.html#more-formats"><i class="fa fa-check"></i><b>4.1.3</b> More formats</a></li>
<li class="chapter" data-level="4.1.4" data-path="manip.html"><a href="manip.html#read-from-databases-big-data"><i class="fa fa-check"></i><b>4.1.4</b> Read from databases / big data</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="manip.html"><a href="manip.html#the-grammar-of-data-manipulation"><i class="fa fa-check"></i><b>4.2</b> The grammar of data manipulation</a><ul>
<li class="chapter" data-level="4.2.1" data-path="manip.html"><a href="manip.html#the-pipe"><i class="fa fa-check"></i><b>4.2.1</b> The pipe</a></li>
<li class="chapter" data-level="4.2.2" data-path="manip.html"><a href="manip.html#the-verbs-of-manipulation"><i class="fa fa-check"></i><b>4.2.2</b> The verbs of manipulation</a></li>
<li class="chapter" data-level="4.2.3" data-path="manip.html"><a href="manip.html#filter-conditions"><i class="fa fa-check"></i><b>4.2.3</b> Filter : conditions</a></li>
<li class="chapter" data-level="4.2.4" data-path="manip.html"><a href="manip.html#mutate"><i class="fa fa-check"></i><b>4.2.4</b> Mutate</a></li>
<li class="chapter" data-level="4.2.5" data-path="manip.html"><a href="manip.html#summarize"><i class="fa fa-check"></i><b>4.2.5</b> Summarize</a></li>
<li class="chapter" data-level="4.2.6" data-path="manip.html"><a href="manip.html#join-with-other-tables"><i class="fa fa-check"></i><b>4.2.6</b> Join with other tables</a></li>
<li class="chapter" data-level="4.2.7" data-path="manip.html"><a href="manip.html#manipulate-several-data-in-the-same-time"><i class="fa fa-check"></i><b>4.2.7</b> Manipulate several data in the same time</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="manip.html"><a href="manip.html#lets-import-and-wrangle-some-data"><i class="fa fa-check"></i><b>4.3</b> Let’s import and wrangle some data !</a><ul>
<li class="chapter" data-level="4.3.1" data-path="manip.html"><a href="manip.html#the-data"><i class="fa fa-check"></i><b>4.3.1</b> The data</a></li>
<li class="chapter" data-level="4.3.2" data-path="manip.html"><a href="manip.html#one-tool-you-will-need-lapply"><i class="fa fa-check"></i><b>4.3.2</b> One tool you will need : <code>lapply()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="manip.html"><a href="manip.html#tidy-your-data"><i class="fa fa-check"></i><b>4.4</b> Tidy your data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="stats.html"><a href="stats.html"><i class="fa fa-check"></i><b>5</b> Statistics</a><ul>
<li class="chapter" data-level="5.1" data-path="stats.html"><a href="stats.html#definitions"><i class="fa fa-check"></i><b>5.1</b> Definitions</a><ul>
<li class="chapter" data-level="5.1.1" data-path="stats.html"><a href="stats.html#terminology"><i class="fa fa-check"></i><b>5.1.1</b> Terminology</a></li>
<li class="chapter" data-level="5.1.2" data-path="stats.html"><a href="stats.html#types-of-variables"><i class="fa fa-check"></i><b>5.1.2</b> Types of variables</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="stats.html"><a href="stats.html#univariate-statistics"><i class="fa fa-check"></i><b>5.2</b> Univariate statistics</a><ul>
<li class="chapter" data-level="5.2.1" data-path="stats.html"><a href="stats.html#numerical-variables"><i class="fa fa-check"></i><b>5.2.1</b> Numerical variables</a></li>
<li class="chapter" data-level="5.2.2" data-path="stats.html"><a href="stats.html#categorical-variables"><i class="fa fa-check"></i><b>5.2.2</b> Categorical variables</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="stats.html"><a href="stats.html#bivariate-statistics"><i class="fa fa-check"></i><b>5.3</b> Bivariate statistics</a><ul>
<li class="chapter" data-level="5.3.1" data-path="stats.html"><a href="stats.html#continuous-variables"><i class="fa fa-check"></i><b>5.3.1</b> 2 continuous variables</a></li>
<li class="chapter" data-level="5.3.2" data-path="stats.html"><a href="stats.html#categorical-variables-1"><i class="fa fa-check"></i><b>5.3.2</b> 2 categorical variables</a></li>
<li class="chapter" data-level="5.3.3" data-path="stats.html"><a href="stats.html#continuous-1-categorical-variable"><i class="fa fa-check"></i><b>5.3.3</b> 1 continuous, 1 categorical variable</a></li>
<li class="chapter" data-level="5.3.4" data-path="stats.html"><a href="stats.html#exercises-1"><i class="fa fa-check"></i><b>5.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="stats.html"><a href="stats.html#stat_inf"><i class="fa fa-check"></i><b>5.4</b> Statistical inference</a><ul>
<li class="chapter" data-level="5.4.1" data-path="stats.html"><a href="stats.html#the-statistical-model"><i class="fa fa-check"></i><b>5.4.1</b> The statistical model</a></li>
<li class="chapter" data-level="5.4.2" data-path="stats.html"><a href="stats.html#two-fundamental-theorems"><i class="fa fa-check"></i><b>5.4.2</b> Two fundamental theorems</a></li>
<li class="chapter" data-level="5.4.3" data-path="stats.html"><a href="stats.html#statistical-tests"><i class="fa fa-check"></i><b>5.4.3</b> Statistical tests</a></li>
<li class="chapter" data-level="5.4.4" data-path="stats.html"><a href="stats.html#other-estimators-maximum-of-likelihood"><i class="fa fa-check"></i><b>5.4.4</b> Other estimators : maximum of likelihood</a></li>
<li class="chapter" data-level="5.4.5" data-path="stats.html"><a href="stats.html#exercises-interprete-a-test-you-dont-know"><i class="fa fa-check"></i><b>5.4.5</b> Exercises : interprete a test you don’t know</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="multivar.html"><a href="multivar.html"><i class="fa fa-check"></i><b>6</b> Multivariate analysis and dimension reduction</a><ul>
<li class="chapter" data-level="6.1" data-path="multivar.html"><a href="multivar.html#multivariate-analysis"><i class="fa fa-check"></i><b>6.1</b> Multivariate analysis</a><ul>
<li class="chapter" data-level="6.1.1" data-path="multivar.html"><a href="multivar.html#advanced-visualization"><i class="fa fa-check"></i><b>6.1.1</b> Advanced visualization</a></li>
<li class="chapter" data-level="6.1.2" data-path="multivar.html"><a href="multivar.html#easily-explore-an-entire-dataset"><i class="fa fa-check"></i><b>6.1.2</b> Easily explore an entire dataset</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="multivar.html"><a href="multivar.html#multivariate-analysis-and-dimension-reduction"><i class="fa fa-check"></i><b>6.2</b> Multivariate analysis and dimension reduction</a><ul>
<li class="chapter" data-level="6.2.1" data-path="multivar.html"><a href="multivar.html#imputation"><i class="fa fa-check"></i><b>6.2.1</b> Imputation</a></li>
<li class="chapter" data-level="6.2.2" data-path="multivar.html"><a href="multivar.html#normalization"><i class="fa fa-check"></i><b>6.2.2</b> Normalization</a></li>
<li class="chapter" data-level="6.2.3" data-path="multivar.html"><a href="multivar.html#pca"><i class="fa fa-check"></i><b>6.2.3</b> PCA</a></li>
<li class="chapter" data-level="6.2.4" data-path="stats.html"><a href="stats.html#exercises"><i class="fa fa-check"></i><b>6.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="multivar.html"><a href="multivar.html#dimension-reduction"><i class="fa fa-check"></i><b>6.3</b> Dimension reduction</a><ul>
<li class="chapter" data-level="6.3.1" data-path="multivar.html"><a href="multivar.html#use-the-results-of-the-pca"><i class="fa fa-check"></i><b>6.3.1</b> Use the results of the PCA</a></li>
<li class="chapter" data-level="6.3.2" data-path="multivar.html"><a href="multivar.html#other-inertia-based-methods"><i class="fa fa-check"></i><b>6.3.2</b> Other inertia-based methods</a></li>
<li class="chapter" data-level="6.3.3" data-path="multivar.html"><a href="multivar.html#t-sne"><i class="fa fa-check"></i><b>6.3.3</b> t-SNE</a></li>
<li class="chapter" data-level="6.3.4" data-path="multivar.html"><a href="multivar.html#a-word-about-clustering"><i class="fa fa-check"></i><b>6.3.4</b> A word about clustering</a></li>
<li class="chapter" data-level="6.3.5" data-path="intro-r.html"><a href="intro-r.html#exercise"><i class="fa fa-check"></i><b>6.3.5</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="multivar.html"><a href="multivar.html#visualization-bonus-dashboards-and-reports"><i class="fa fa-check"></i><b>6.4</b> Visualization bonus : dashboards and reports</a><ul>
<li class="chapter" data-level="6.4.1" data-path="multivar.html"><a href="multivar.html#shiny-and-rmarkdown"><i class="fa fa-check"></i><b>6.4.1</b> Shiny and rmarkdown</a></li>
<li class="chapter" data-level="6.4.2" data-path="multivar.html"><a href="multivar.html#web-based-graphics-with-plotly"><i class="fa fa-check"></i><b>6.4.2</b> Web-based graphics with <code>plotly</code></a></li>
<li class="chapter" data-level="6.4.3" data-path="multivar.html"><a href="multivar.html#other-packages-widgets"><i class="fa fa-check"></i><b>6.4.3</b> Other packages &amp; widgets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="reg.html"><a href="reg.html"><i class="fa fa-check"></i><b>7</b> Linear and logistic regression</a><ul>
<li class="chapter" data-level="7.1" data-path="reg.html"><a href="reg.html#linear-regression"><i class="fa fa-check"></i><b>7.1</b> Linear regression</a><ul>
<li class="chapter" data-level="7.1.1" data-path="reg.html"><a href="reg.html#general-presentation"><i class="fa fa-check"></i><b>7.1.1</b> General presentation</a></li>
<li class="chapter" data-level="7.1.2" data-path="reg.html"><a href="reg.html#coefficients-interpretation-and-inference"><i class="fa fa-check"></i><b>7.1.2</b> Coefficients interpretation and inference</a></li>
<li class="chapter" data-level="7.1.3" data-path="reg.html"><a href="reg.html#the-frischwaugh-theorem-and-the-omitted-variable-bias"><i class="fa fa-check"></i><b>7.1.3</b> The Frisch–Waugh Theorem and the omitted variable bias</a></li>
<li class="chapter" data-level="7.1.4" data-path="reg.html"><a href="reg.html#feature-engineering-and-functional-specification"><i class="fa fa-check"></i><b>7.1.4</b> Feature engineering and functional specification</a></li>
<li class="chapter" data-level="7.1.5" data-path="reg.html"><a href="reg.html#variable-selection"><i class="fa fa-check"></i><b>7.1.5</b> Variable selection</a></li>
<li class="chapter" data-level="7.1.6" data-path="stats.html"><a href="stats.html#exercises"><i class="fa fa-check"></i><b>7.1.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="reg.html"><a href="reg.html#logitic-regression"><i class="fa fa-check"></i><b>7.2</b> Logitic regression</a><ul>
<li class="chapter" data-level="7.2.1" data-path="reg.html"><a href="reg.html#mathematical-formulation"><i class="fa fa-check"></i><b>7.2.1</b> Mathematical formulation</a></li>
<li class="chapter" data-level="7.2.2" data-path="reg.html"><a href="reg.html#implementation-in-r-and-interpretation"><i class="fa fa-check"></i><b>7.2.2</b> Implementation in R and interpretation</a></li>
<li class="chapter" data-level="7.2.3" data-path="reg.html"><a href="reg.html#goodness-of-fit"><i class="fa fa-check"></i><b>7.2.3</b> Goodness of fit</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data exploration and statistics with R and the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="manip" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Data manipulation</h1>
<p><img src="img/data-viz.jpg" /></p>
<p>In order to manipulate and wrangle data, there are (at least) 3 frameworks available :</p>
<ul>
<li>Base R (not covered) : similar to Pandas</li>
<li>Tidyverse/dplyr : high level interface</li>
<li><code>data.table</code> : less friendly user interface but amazingly optimized</li>
</ul>
<p>We’ll cover the tidyverse approach as it provides a very nice and coherent framework for more than data manipulation. The “tidy” comes an original <a href="http://www.jstatsoft.org/v59/i10/paper">paper from Hadley Wickham</a> which sets those common sense principles</p>
<ul>
<li>Each variable must have its own column.</li>
<li>Each observation must have its own row.</li>
<li>Each value must have its own cell.</li>
</ul>
<p>You can check further details and visualization on the <a href="https://r4ds.had.co.nz/tidy-data.html">R for data science online book</a></p>
<p>Those principles have been largely adopted by the community (powered by Rstudio) and created a full parallel dialect in R for almost all data science tasks : the <a href="https://www.tidyverse.org/"><strong>tidyverse</strong></a> which offers a coherent set of features that are, in addition, often nicely optimized (written in C++)</p>
<div id="import" class="section level2">
<h2><span class="header-section-number">4.1</span> Import</h2>
<div id="text-files" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Text files</h3>
<p>You can either use the basic <code>read.table</code> and related functions (eg <code>read.csv</code>) which work pretty fine. If the file is large, you might consider tools from other package such as read_csv and others from the <code>readr</code> package (part of the tidyverse)</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="manip.html#cb77-1"></a>dat &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;Data/Sports/Activities.csv&quot;</span>,<span class="dt">header =</span> T)</span>
<span id="cb77-2"><a href="manip.html#cb77-2"></a><span class="kw">head</span>(dat)</span></code></pre></div>
<pre><code>##   activityId       uuidMsb       uuidLsb                name activityType
## 1 5570974040  3.695224e+18 -7.098507e+18          En piscine lap_swimming
## 2 5566524321 -5.212790e+18 -8.140623e+18     Vienna Cyclisme      cycling
## 3 5561266034  1.271356e+18 -5.522844e+18 Korneuburg Cyclisme      cycling
## 4 5555881653 -2.923938e+18 -4.676832e+18       Vienna Course      running
## 5 5551811953  7.859043e+18 -7.909532e+18      Zwift - London virtual_ride
## 6 5551052200 -9.554086e+17 -6.866435e+18          En piscine lap_swimming
##   userProfileId timeZoneId beginTimestamp eventTypeId   rule sportType
## 1       1141258        124   1.600700e+12           9 public   GENERIC
## 2       1141258        124   1.600602e+12           9 public   CYCLING
## 3       1141258        124   1.600523e+12           9 public   CYCLING
## 4       1141258        124   1.600439e+12           9 public   RUNNING
## 5       1141258        124   1.600362e+12           9 public   GENERIC
## 6       1141258        124   1.600353e+12           9 public   GENERIC
##   startTimeGmt startTimeLocal duration distance elevationGain elevationLoss
## 1 1.600700e+12   1.600708e+12  3640221   300000            NA            NA
## 2 1.600602e+12   1.600609e+12 15064570 12293220        200100        196800
## 3 1.600523e+12   1.600530e+12 10382433  8360927         74500         74200
## 4 1.600439e+12   1.600447e+12  5393830  1792890         42600         42500
## 5 1.600362e+12   1.600369e+12  3626825  3492347         16000             0
## 6 1.600353e+12   1.600360e+12  3359145   285000            NA            NA
##   avgSpeed maxSpeed avgHr maxHr  calories startLongitude startLatitude
## 1   0.0986   0.1122    NA    NA  2547.532             NA            NA
## 2   0.8160   1.9315   144   176 16345.268       16.31524      48.20915
## 3   0.8053   1.9557   117   161  8744.572       16.33986      48.34994
## 4   0.3324   1.2475   155   176  4923.274       16.31587      48.21432
## 5   0.9629   1.6364   138   163  3083.855        0.00000       0.00000
## 6   0.1011   0.3524    NA    NA  2505.632             NA            NA
##   aerobicTrainingEffect avgFractionalCadence maxFractionalCadence
## 1                    NA               0.0000                    0
## 2                   3.5               0.0000                    0
## 3                   2.4               0.0000                    0
## 4                   3.0               0.1875                    0
## 5                   0.0               0.0000                    0
## 6                    NA               0.0000                    0
##   elapsedDuration movingDuration anaerobicTrainingEffect   deviceId
## 1         3955901        3099653                      NA 3968818126
## 2        16176575       15000179                     0.0 3968818126
## 3        11319866       10356078                     0.0 3968818126
## 4         5538505        5389603                     0.2 3968818126
## 5         3629000        3611000                      NA 3825981698
## 6         3585826        2858951                      NA 3968818126
##   minTemperature maxTemperature minElevation maxElevation        locationName
## 1             25             26           NA           NA                &lt;NA&gt;
## 2             19             29        18480        95480              Vienna
## 3             18             29        13980        32200          Korneuburg
## 4             19             27        24920        54400              Vienna
## 5             NA             NA          300         3420 City of Westminster
## 6             26             27           NA           NA                &lt;NA&gt;
##   maxVerticalSpeed lapCount endLongitude endLatitude activeSets totalSets
## 1               NA       34           NA          NA         NA        NA
## 2       0.43999939       25     16.25314    48.20399         NA        NA
## 3       0.34000092       17     16.38793    48.38009         NA        NA
## 4       0.08000183       18     16.31980    48.22264         NA        NA
## 5       0.16000004        1           NA          NA         NA        NA
## 6               NA       32           NA          NA         NA        NA
##   totalReps purposeful autoCalcCalories favorite    pr elevationCorrected
## 1        NA      FALSE            FALSE    FALSE FALSE              FALSE
## 2        NA      FALSE            FALSE    FALSE FALSE              FALSE
## 3        NA      FALSE            FALSE    FALSE FALSE              FALSE
## 4        NA      FALSE            FALSE    FALSE FALSE              FALSE
## 5        NA      FALSE            FALSE    FALSE FALSE              FALSE
## 6        NA      FALSE            FALSE    FALSE FALSE              FALSE
##   atpActivity parent maxRunCadence steps avgVerticalOscillation
## 1       FALSE  FALSE            NA    NA                     NA
## 2       FALSE  FALSE            NA    NA                     NA
## 3       FALSE  FALSE            NA    NA                     NA
## 4       FALSE  FALSE           104 15620                     NA
## 5       FALSE  FALSE            NA    NA                     NA
## 6       FALSE  FALSE            NA    NA                     NA
##   avgGroundContactTime avgStrideLength vO2MaxValue avgVerticalRatio
## 1                   NA              NA          NA               NA
## 2                   NA              NA          72               NA
## 3                   NA              NA          71               NA
## 4                   NA        115.6389          58               NA
## 5                   NA              NA          NA               NA
## 6                   NA              NA          NA               NA
##   avgGroundContactBalance avgDoubleCadence maxDoubleCadence avgPower
## 1                      NA               NA               NA       NA
## 2                      NA               NA               NA      260
## 3                      NA               NA               NA      202
## 4                      NA          172.375              208       NA
## 5                      NA               NA               NA      212
## 6                      NA               NA               NA       NA
##   avgBikeCadence maxBikeCadence strokes normPower avgLeftBalance
## 1             NA             NA    1198        NA             NA
## 2             83            114   17968  296.0000          49.92
## 3             82            107   12571  231.0000          49.90
## 4             NA             NA      NA        NA             NA
## 5             91            114       0  218.3049             NA
## 6             NA             NA    1152        NA             NA
##   avgRightBalance max20MinPower trainingStressScore intensityFactor
## 1              NA            NA                  NA              NA
## 2           50.08      375.1583               291.4           0.835
## 3           50.10      242.7692               122.8           0.653
## 4              NA            NA                  NA              NA
## 5              NA      221.0525                  NA              NA
## 6              NA            NA                  NA              NA
##   lactateThresholdBpm lactateThresholdSpeed avgStrokes activeLengths avgSwolf
## 1                  NA                    NA       23.0            60       74
## 2                  NA                    NA         NA            NA       NA
## 3                  NA                    NA         NA            NA       NA
## 4                  NA                    NA         NA            NA       NA
## 5                  NA                    NA         NA            NA       NA
## 6                  NA                    NA       22.6            57       72
##   poolLength avgStrokeDistance avgSwimCadence maxSwimCadence maxFtp workoutId
## 1       5000               217             27             29     NA        NA
## 2         NA                NA             NA             NA     NA        NA
## 3         NA                NA             NA             NA     NA        NA
## 4         NA                NA             NA             NA     NA        NA
## 5         NA                NA             NA             NA     NA        NA
## 6       5000               221             27             30     NA        NA
##   decoDive parentId avgVerticalSpeed maxDepth avgDepth surfaceInterval
## 1       NA       NA               NA       NA       NA              NA
## 2       NA       NA               NA       NA       NA              NA
## 3       NA       NA               NA       NA       NA              NA
## 4       NA       NA               NA       NA       NA              NA
## 5       NA       NA               NA       NA       NA              NA
## 6       NA       NA               NA       NA       NA              NA
##   floorsDescended bottomTime
## 1              NA         NA
## 2              NA         NA
## 3              NA         NA
## 4              NA         NA
## 5              NA         NA
## 6              NA         NA</code></pre>
<p>You have many options to deal with issues :</p>
<ul>
<li><code>sep</code> to specify the separator (<code>\t</code> for tabulation, <code>';'</code> for semicolon… )</li>
<li><code>dec</code> the decimal separator</li>
<li><code>encoding</code> the file encoding (special characters from windows/unix systems can be misdetected)</li>
<li><code>colClasses</code> to force one column to be imported in another type than what is detected</li>
<li><code>help(read.table)</code> for more options !</li>
</ul>
</div>
<div id="excel-files" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Excel files</h3>
<p>You can import excel files (.xls and .xlsx) with the <code>readxl</code> package</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="manip.html#cb79-1"></a>readxl<span class="op">::</span><span class="kw">read_excel</span>(<span class="st">&quot;Data/Sports/Activities.xlsx&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb79-2"><a href="manip.html#cb79-2"></a><span class="st">  </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 89
##   activityId uuidMsb uuidLsb name  activityType userProfileId timeZoneId
##        &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;                &lt;dbl&gt;      &lt;dbl&gt;
## 1 5570974040 3.6952… -7.098… En p… lap_swimming       1141258        124
## 2 5566524321 -5.212… -8.140… Vien… cycling            1141258        124
## 3 5561266034 1.2713… -5.522… Korn… cycling            1141258        124
## 4 5555881653 -2.923… -4.676… Vien… running            1141258        124
## 5 5551811953 7.8590… -7.909… Zwif… virtual_ride       1141258        124
## 6 5551052200 -9.554… -6.866… En p… lap_swimming       1141258        124
## # … with 82 more variables: beginTimestamp &lt;chr&gt;, eventTypeId &lt;dbl&gt;,
## #   rule &lt;chr&gt;, sportType &lt;chr&gt;, startTimeGmt &lt;dbl&gt;, startTimeLocal &lt;chr&gt;,
## #   duration &lt;chr&gt;, distance &lt;chr&gt;, elevationGain &lt;chr&gt;, elevationLoss &lt;chr&gt;,
## #   avgSpeed &lt;chr&gt;, maxSpeed &lt;chr&gt;, avgHr &lt;chr&gt;, maxHr &lt;chr&gt;, calories &lt;chr&gt;,
## #   startLongitude &lt;chr&gt;, startLatitude &lt;chr&gt;, aerobicTrainingEffect &lt;chr&gt;,
## #   avgFractionalCadence &lt;chr&gt;, maxFractionalCadence &lt;chr&gt;,
## #   elapsedDuration &lt;chr&gt;, movingDuration &lt;chr&gt;, anaerobicTrainingEffect &lt;chr&gt;,
## #   deviceId &lt;dbl&gt;, minTemperature &lt;chr&gt;, maxTemperature &lt;chr&gt;,
## #   minElevation &lt;chr&gt;, maxElevation &lt;chr&gt;, locationName &lt;chr&gt;,
## #   maxVerticalSpeed &lt;chr&gt;, lapCount &lt;dbl&gt;, endLongitude &lt;chr&gt;,
## #   endLatitude &lt;chr&gt;, activeSets &lt;chr&gt;, totalSets &lt;chr&gt;, totalReps &lt;chr&gt;,
## #   purposeful &lt;chr&gt;, autoCalcCalories &lt;chr&gt;, favorite &lt;chr&gt;, pr &lt;chr&gt;,
## #   elevationCorrected &lt;chr&gt;, atpActivity &lt;chr&gt;, parent &lt;chr&gt;,
## #   maxRunCadence &lt;chr&gt;, steps &lt;chr&gt;, avgVerticalOscillation &lt;chr&gt;,
## #   avgGroundContactTime &lt;chr&gt;, avgStrideLength &lt;chr&gt;, vO2MaxValue &lt;chr&gt;,
## #   avgVerticalRatio &lt;chr&gt;, avgGroundContactBalance &lt;chr&gt;,
## #   avgDoubleCadence &lt;chr&gt;, maxDoubleCadence &lt;chr&gt;, avgPower &lt;chr&gt;,
## #   avgBikeCadence &lt;chr&gt;, maxBikeCadence &lt;chr&gt;, strokes &lt;chr&gt;, normPower &lt;chr&gt;,
## #   avgLeftBalance &lt;chr&gt;, avgRightBalance &lt;chr&gt;, max20MinPower &lt;chr&gt;,
## #   trainingStressScore &lt;chr&gt;, intensityFactor &lt;chr&gt;,
## #   lactateThresholdBpm &lt;chr&gt;, lactateThresholdSpeed &lt;chr&gt;, avgStrokes &lt;chr&gt;,
## #   activeLengths &lt;chr&gt;, avgSwolf &lt;chr&gt;, poolLength &lt;chr&gt;,
## #   avgStrokeDistance &lt;chr&gt;, avgSwimCadence &lt;chr&gt;, maxSwimCadence &lt;chr&gt;,
## #   maxFtp &lt;chr&gt;, workoutId &lt;chr&gt;, decoDive &lt;chr&gt;, parentId &lt;chr&gt;,
## #   avgVerticalSpeed &lt;chr&gt;, maxDepth &lt;chr&gt;, avgDepth &lt;chr&gt;,
## #   surfaceInterval &lt;chr&gt;, floorsDescended &lt;chr&gt;, bottomTime &lt;chr&gt;</code></pre>
<p>Options :</p>
<ul>
<li><code>sheet</code> to select whioch you want to import</li>
<li><code>range</code> : the “zone” of the sheet you want to import (beginning and ending row/column to be provided)</li>
<li><code>col_types</code> to specify the types of the column if misdetected</li>
<li><code>?readxl::read_excel</code> for more information</li>
</ul>
</div>
<div id="more-formats" class="section level3">
<h3><span class="header-section-number">4.1.3</span> More formats</h3>
<p>The <code>readr</code> package provides other convenient functions to read the most common (open) formats. With <code>haven</code>, you can also read data from proprietary formats (SPSS, SAS, Stat,…).</p>
<p>JSON files can be read with for example <code>rjsonlite</code> and we will use it in an applicaiton example.</p>
<p>XML and HTML files can be parsed with the <code>xml2</code>package.</p>
</div>
<div id="read-from-databases-big-data" class="section level3">
<h3><span class="header-section-number">4.1.4</span> Read from databases / big data</h3>
<p>This is a huge topic that we will only mention here, but for (almost) each database engine, there is a package available in order to be able to read data from databases</p>
<ul>
<li>General purpose : <code>odbc</code>, <code>RODBC</code>, <code>DBI</code> <span class="math inline">\(\rightarrow\)</span> you will need to install the DB’s drivers</li>
<li>Dedicated : <code>RSQLite</code>, <code>RPostgres</code>, <code>RMariaDB</code> (can be used for mySQL too)… <span class="math inline">\(\rightarrow\)</span> drivers included</li>
</ul>
<p>With the 3 first package, you can connect to “monolith” databases, as well as to distributed databases. You can find more information on the <a href="https://db.rstudio.com/">Rstudio website</a>. Another interesting resources is the <a href="https://cran.r-project.org/web/packages/dbplyr/vignettes/dbplyr.html"><code>dbplyr</code> vignette</a>, that describes how to connect to a database and query it using <code>dplyr</code>’s verbs.</p>
<p>In addition, the <code>sparlyr</code> package allows you to interact with a spark cluster (using <code>dplyr syntax</code>)</p>
</div>
</div>
<div id="the-grammar-of-data-manipulation" class="section level2">
<h2><span class="header-section-number">4.2</span> The grammar of data manipulation</h2>
<p><strong>Alert :</strong> After this section, pandas will appear much less appealing….
<img src="img/pandas-fun.jpg" /></p>
<p>Following the tidy data principles, <code>dplyr</code> implements an actual grammar of data manipulation with verbs and human-readable syntax.</p>
<div id="the-pipe" class="section level3">
<h3><span class="header-section-number">4.2.1</span> The pipe</h3>
<p><img src="img/pipe.png" /></p>
<p>The first operator to know is the <em>pipe</em> operator, <code>%&gt;%</code> which allows you to redirect the output of a command “to the right” and hence create readable chains of commands.
Let’s extract the last 3 characters of “hello world”</p>
<p>First solution : create useless objects</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="manip.html#cb81-1"></a>char &lt;-<span class="st"> &quot;hello world&quot;</span></span>
<span id="cb81-2"><a href="manip.html#cb81-2"></a>rev_char &lt;-<span class="st"> </span>stringi<span class="op">::</span><span class="kw">stri_reverse</span>(char)</span>
<span id="cb81-3"><a href="manip.html#cb81-3"></a>sub3 &lt;-<span class="st"> </span><span class="kw">substr</span>(rev_char,<span class="dv">1</span>,<span class="dv">3</span>)</span>
<span id="cb81-4"><a href="manip.html#cb81-4"></a>stringi<span class="op">::</span><span class="kw">stri_reverse</span>(sub3)</span></code></pre></div>
<pre><code>## [1] &quot;rld&quot;</code></pre>
<p>Second solution : where’s the beginning ????</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="manip.html#cb83-1"></a>stringi<span class="op">::</span><span class="kw">stri_reverse</span>(<span class="kw">substr</span>(stringi<span class="op">::</span><span class="kw">stri_reverse</span>(<span class="st">&quot;Hello World&quot;</span>),<span class="dv">1</span>,<span class="dv">3</span>))</span></code></pre></div>
<pre><code>## [1] &quot;rld&quot;</code></pre>
<p>Third solution : using the pipe</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="manip.html#cb85-1"></a><span class="st">&quot;Hello world&quot;</span> <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb85-2"><a href="manip.html#cb85-2"></a><span class="st">  </span>stringi<span class="op">::</span><span class="kw">stri_reverse</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb85-3"><a href="manip.html#cb85-3"></a><span class="st">  </span><span class="kw">substr</span>(<span class="dv">1</span>,<span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb85-4"><a href="manip.html#cb85-4"></a><span class="st">  </span>stringi<span class="op">::</span><span class="kw">stri_reverse</span>()</span></code></pre></div>
<pre><code>## [1] &quot;rld&quot;</code></pre>
<p>Under the hood : the dot represents the result of the previous step and can be placed somewhere else in the next function (rather than the first argument)</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="manip.html#cb87-1"></a><span class="st">&quot;Hello world&quot;</span> <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb87-2"><a href="manip.html#cb87-2"></a><span class="st">  </span>stringi<span class="op">::</span><span class="kw">stri_reverse</span>(.) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb87-3"><a href="manip.html#cb87-3"></a><span class="st">  </span><span class="kw">substr</span>(.,<span class="dv">1</span>,<span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb87-4"><a href="manip.html#cb87-4"></a><span class="st">  </span>stringi<span class="op">::</span><span class="kw">stri_reverse</span>(.)</span></code></pre></div>
<pre><code>## [1] &quot;rld&quot;</code></pre>
</div>
<div id="the-verbs-of-manipulation" class="section level3">
<h3><span class="header-section-number">4.2.2</span> The verbs of manipulation</h3>
<p>What do you do with data ?</p>
<ul>
<li>Select columns <span class="math inline">\(\rightarrow\)</span> <code>select()</code></li>
<li>Filter rows <span class="math inline">\(\rightarrow\)</span> <code>filter()</code></li>
<li>Create / modify columns <span class="math inline">\(\rightarrow\)</span> <code>mutate()</code></li>
<li>Compute summaries of the columns <span class="math inline">\(\rightarrow\)</span> <code>summarise()</code></li>
<li>Do group-wise operations <span class="math inline">\(\rightarrow\)</span> <code>group_by()</code></li>
<li>Join with other tables <span class="math inline">\(\rightarrow\)</span> <code>left_join()</code>,<code>right_join()</code>, <code>inner_join()</code>, <code>anti_join()</code>, <code>full_join()</code></li>
</ul>
<p>I have the verbs, now I can associate them to make a sentence ! All those functions take as first argument a dataframe, which makes it very easy when chaining them with the pipe.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="manip.html#cb89-1"></a><span class="kw">read.csv</span>(<span class="st">&quot;Data/Sports/Activities.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb89-2"><a href="manip.html#cb89-2"></a><span class="st">  </span><span class="kw">select</span>(activityType,avgSpeed,distance,startLongitude,startLatitude,sportType) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#select some metrics</span></span>
<span id="cb89-3"><a href="manip.html#cb89-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">distance=</span>distance<span class="op">/</span><span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># distances are in decameter (?)</span></span>
<span id="cb89-4"><a href="manip.html#cb89-4"></a><span class="st">  </span><span class="kw">filter</span>(activityType<span class="op">!=</span><span class="st">&quot;other&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># remove activities &quot;other</span></span>
<span id="cb89-5"><a href="manip.html#cb89-5"></a><span class="st">  </span><span class="kw">group_by</span>(activityType) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb89-6"><a href="manip.html#cb89-6"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_dist=</span><span class="kw">mean</span>(distance))</span></code></pre></div>
<pre><code>## # A tibble: 22 x 2
##    activityType            total_dist
##    &lt;chr&gt;                        &lt;dbl&gt;
##  1 cross_country_skiing_ws     16717.
##  2 cycling                     34124.
##  3 cyclocross                  41210.
##  4 hiking                      10678.
##  5 indoor_cardio                  NA 
##  6 indoor_cycling                 NA 
##  7 indoor_running               2311.
##  8 lap_swimming                 3014.
##  9 multi_sport                 63873.
## 10 open_water_swimming          2359.
## # … with 12 more rows</code></pre>
</div>
<div id="filter-conditions" class="section level3">
<h3><span class="header-section-number">4.2.3</span> Filter : conditions</h3>
<p>This is the way you write conditions in R :</p>
<table>
<thead>
<tr class="header">
<th>Syntax</th>
<th>Condition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>==</td>
<td>Equality test</td>
</tr>
<tr class="even">
<td>!=</td>
<td>Different than</td>
</tr>
<tr class="odd">
<td>%in% c(…)</td>
<td>Is in this list of values</td>
</tr>
<tr class="even">
<td><span class="math inline">\(&gt;, &gt;=\)</span> <span class="math inline">\(&lt;, &lt;=\)</span></td>
<td>Greater/less than</td>
</tr>
<tr class="odd">
<td>! (x %in% c(…))</td>
<td>Not in the list</td>
</tr>
<tr class="even">
<td>&amp;</td>
<td>And</td>
</tr>
<tr class="odd">
<td>|</td>
<td>Or</td>
</tr>
</tbody>
</table>
</div>
<div id="mutate" class="section level3">
<h3><span class="header-section-number">4.2.4</span> Mutate</h3>
<p>Most of the data manipulation will be done in a mutate statement. This is where you can create additional columns, modify the ones existing. You can do any kind of transformation you want with this one. Depending on the type of the data, here are some additional packages that will help you :</p>
<ul>
<li><code>lubridate</code> to easily handle date variables</li>
<li><code>forcats</code> to handle factors (categorical variables)</li>
<li><code>stringr</code> (and <code>stringi</code>) to handle strings variables and work with regular expressions</li>
<li><code>ifelse()</code> and <code>case_when()</code> to handle conditional operations</li>
</ul>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="manip.html#cb91-1"></a><span class="kw">require</span>(lubridate)</span>
<span id="cb91-2"><a href="manip.html#cb91-2"></a><span class="kw">require</span>(stringr)</span>
<span id="cb91-3"><a href="manip.html#cb91-3"></a></span>
<span id="cb91-4"><a href="manip.html#cb91-4"></a>dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb91-5"><a href="manip.html#cb91-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">start_time=</span><span class="kw">as_datetime</span>(startTimeLocal<span class="op">/</span><span class="dv">1000</span>), <span class="co"># create a timestamp</span></span>
<span id="cb91-6"><a href="manip.html#cb91-6"></a>         <span class="dt">date =</span> <span class="kw">floor_date</span>(start_time,<span class="st">&quot;day&quot;</span>), <span class="co"># round to the day</span></span>
<span id="cb91-7"><a href="manip.html#cb91-7"></a>         <span class="dt">is_bike=</span><span class="kw">ifelse</span>(activityType <span class="op">%in%</span></span>
<span id="cb91-8"><a href="manip.html#cb91-8"></a><span class="st">                          </span><span class="kw">c</span>(<span class="st">&quot;cycling&quot;</span>,<span class="st">&quot;virtual_ride&quot;</span>,<span class="st">&quot;indoor_cycling&quot;</span>,<span class="st">&quot;road_biking&quot;</span>,<span class="st">&quot;cyclocross&quot;</span>),T,F),</span>
<span id="cb91-9"><a href="manip.html#cb91-9"></a>         <span class="co"># is it bike or not ?</span></span>
<span id="cb91-10"><a href="manip.html#cb91-10"></a>         <span class="dt">is_run =</span> <span class="kw">str_detect</span>(activityType,<span class="st">&quot;running|hicking&quot;</span>),</span>
<span id="cb91-11"><a href="manip.html#cb91-11"></a>         <span class="dt">activity_recoded =</span> <span class="kw">case_when</span>(is_bike <span class="op">~</span><span class="st"> &quot;Bike&quot;</span>,</span>
<span id="cb91-12"><a href="manip.html#cb91-12"></a>                                      is_run <span class="op">~</span><span class="st"> &quot;Run&quot;</span>,</span>
<span id="cb91-13"><a href="manip.html#cb91-13"></a>                                      <span class="kw">str_detect</span>(activityType,<span class="st">&quot;swim&quot;</span>) <span class="op">~</span><span class="st">&quot;Swim&quot;</span>,</span>
<span id="cb91-14"><a href="manip.html#cb91-14"></a>                                      <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;Other&quot;</span>))</span></code></pre></div>
</div>
<div id="summarize" class="section level3">
<h3><span class="header-section-number">4.2.5</span> Summarize</h3>
<p>This operation consists in summarizing several rows ofinto one or more synthetic value(s). We will cover the topic more in detail <a href="stats.html#stats">5</a> but the most common summary function that you can use are :</p>
<ul>
<li>For continuous variables : average, sum, median, standard deviation, interquartile range (IQR), concentration indexes,…</li>
<li>For categorical variables : count, count distinct, concentration indexes,…</li>
</ul>
<p>Simple summary statistics over one numerical variable :</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="manip.html#cb92-1"></a>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">total_distance=</span><span class="kw">sum</span>(distance)) <span class="co"># Oups</span></span></code></pre></div>
<pre><code>##   total_distance
## 1             NA</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="manip.html#cb94-1"></a>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">total_distance=</span><span class="kw">sum</span>(distance,<span class="dt">na.rm =</span> T))</span></code></pre></div>
<pre><code>##   total_distance
## 1    10693637146</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="manip.html#cb96-1"></a>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">avg_distance=</span><span class="kw">mean</span>(distance,<span class="dt">na.rm =</span> T))</span></code></pre></div>
<pre><code>##   avg_distance
## 1      1941826</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="manip.html#cb98-1"></a>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">median_distance=</span><span class="kw">median</span>(distance,<span class="dt">na.rm =</span> T))</span></code></pre></div>
<pre><code>##   median_distance
## 1         1186419</code></pre>
</div>
<div id="join-with-other-tables" class="section level3">
<h3><span class="header-section-number">4.2.6</span> Join with other tables</h3>
<p>Thanks to the <code>xxx_join(table_a,table_b)</code> functions you can combine several dataframes into one, matching the rows on chosen columns.</p>
<ul>
<li><code>left_join()</code> will keep the rows coming from table_a</li>
<li><code>right_join()</code> will keep the rows coming from table_b</li>
<li><code>inner_join()</code> will keep the rows present in both tables</li>
<li><code>full_join()</code> will keep the rows from both tables</li>
<li><code>anti_join()</code> will keep the rows from table_a that are not in table_b</li>
</ul>
<p><img src="img/dplyr-joins.png" />
In the following code, we first compute a summary of distance and power for each combination of activity_recoded and deviceId and combine it together with the initial dataframe in order to compute a “distance percentage” for each activity, as the activity distance divided by the total distance recorded for the same type of activity and with the same device.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="manip.html#cb100-1"></a>agg &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></span>
<span id="cb100-2"><a href="manip.html#cb100-2"></a><span class="st">  </span><span class="kw">group_by</span>(activity_recoded,deviceId) <span class="op">%&gt;%</span></span>
<span id="cb100-3"><a href="manip.html#cb100-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_distance=</span><span class="kw">sum</span>(distance,<span class="dt">na.rm =</span> T),</span>
<span id="cb100-4"><a href="manip.html#cb100-4"></a>            <span class="dt">avgPower =</span> <span class="kw">mean</span>(avgPower,<span class="dt">na.rm=</span>T))</span>
<span id="cb100-5"><a href="manip.html#cb100-5"></a>dat <span class="op">%&gt;%</span></span>
<span id="cb100-6"><a href="manip.html#cb100-6"></a><span class="st">  </span><span class="kw">select</span>(distance,activityId,activity_recoded,deviceId) <span class="op">%&gt;%</span></span>
<span id="cb100-7"><a href="manip.html#cb100-7"></a><span class="st">  </span><span class="kw">left_join</span>(agg,<span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;activity_recoded&quot;</span>,<span class="st">&quot;deviceId&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb100-8"><a href="manip.html#cb100-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">distance_pct =</span> <span class="dv">100</span><span class="op">*</span>distance<span class="op">/</span>total_distance) <span class="op">%&gt;%</span></span>
<span id="cb100-9"><a href="manip.html#cb100-9"></a><span class="st">  </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>##   distance activityId activity_recoded   deviceId total_distance avgPower
## 1   300000 5570974040             Swim 3968818126       55009104      NaN
## 2 12293220 5566524321             Bike 3968818126     1419582250 241.7049
## 3  8360927 5561266034             Bike 3968818126     1419582250 241.7049
## 4  1792890 5555881653              Run 3968818126      453582639      NaN
## 5  3492347 5551811953             Bike 3825981698      166719556 228.2449
## 6   285000 5551052200             Swim 3968818126       55009104      NaN
##   distance_pct
## 1    0.5453643
## 2    0.8659745
## 3    0.5889710
## 4    0.3952731
## 5    2.0947434
## 6    0.5180961</code></pre>
</div>
<div id="manipulate-several-data-in-the-same-time" class="section level3">
<h3><span class="header-section-number">4.2.7</span> Manipulate several data in the same time</h3>
<p>With all previous verbs above, you can use the <code>across</code> function to apply the same operation over a bunch of columns that you can select depending a simple enumeration or a condition (on their type or their name). This is a really powerful tool !</p>
<p>Example : we will convert all columns that are identifiers as character variables because the numbers have no meaning</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="manip.html#cb102-1"></a>dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb102-2"><a href="manip.html#cb102-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">c</span>(<span class="kw">contains</span>(<span class="st">&quot;Id&quot;</span>),<span class="kw">contains</span>(<span class="st">&quot;uuid&quot;</span>)),</span>
<span id="cb102-3"><a href="manip.html#cb102-3"></a>                as.character))</span>
<span id="cb102-4"><a href="manip.html#cb102-4"></a><span class="co"># Other stupid examples</span></span>
<span id="cb102-5"><a href="manip.html#cb102-5"></a>dat <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.numeric),</span>
<span id="cb102-6"><a href="manip.html#cb102-6"></a>                          <span class="cf">function</span>(xx) <span class="kw">sum</span>(xx,<span class="dt">na.rm=</span>T)))</span></code></pre></div>
<pre><code>##   beginTimestamp startTimeGmt startTimeLocal    duration    distance
## 1   8.021486e+15 8.036783e+15   8.036814e+15 22850917079 10693637146
##   elevationGain elevationLoss avgSpeed maxSpeed  avgHr  maxHr calories
## 1     163374842     149923907 2186.754 113881.5 538175 637627 20569669
##   startLongitude startLatitude aerobicTrainingEffect avgFractionalCadence
## 1        18707.3      190193.1                7579.3             383.8125
##   maxFractionalCadence elapsedDuration movingDuration anaerobicTrainingEffect
## 1                170.5     11995810258     6623490405                   276.1
##   minTemperature maxTemperature minElevation maxElevation maxVerticalSpeed
## 1          46890          65603     35504232     66534189         322.7602
##   lapCount endLongitude endLatitude activeSets totalSets totalReps
## 1    26369     10138.19    39058.89          0         0         0
##   maxRunCadence    steps avgVerticalOscillation avgGroundContactTime
## 1         81893 27827620                5202.02             149787.7
##   vO2MaxValue avgVerticalRatio avgGroundContactBalance avgDoubleCadence
## 1       50052          4590.83                29360.86         124685.3
##   maxDoubleCadence avgPower avgBikeCadence maxBikeCadence  strokes normPower
## 1           163305   159062         120499         160192 11984172  172253.5
##   avgLeftBalance avgRightBalance max20MinPower trainingStressScore
## 1       29746.24        29853.76      178191.6            146746.6
##   intensityFactor lactateThresholdBpm lactateThresholdSpeed avgStrokes
## 1         640.338               12296               28.8716   36334.99
##   activeLengths avgSwolf poolLength avgStrokeDistance avgSwimCadence
## 1         82178    38881    2028199            113919          21590
##   maxSwimCadence maxFtp avgVerticalSpeed maxDepth avgDepth surfaceInterval
## 1          28979  28273                0        0        0               0
##   floorsDescended bottomTime
## 1               0          0</code></pre>
</div>
</div>
<div id="lets-import-and-wrangle-some-data" class="section level2">
<h2><span class="header-section-number">4.3</span> Let’s import and wrangle some data !</h2>
<div id="the-data" class="section level3">
<h3><span class="header-section-number">4.3.1</span> The data</h3>
<p>We will work on the summary data of all past activities, which come in JSON files. So basically, the data is contained in (nested) lists. This is real word data, it’s super messy and dirty !
You will have to :</p>
<ul>
<li>Import the data
<ul>
<li>Import one of the files using <code>jsonlite</code></li>
<li>Inspect and understand the structure of the list</li>
<li>Get all the metrics that are included</li>
<li>Figure out how to extract one specific metric for one activity</li>
<li>Design a function to extract one metric for all activities contained in the JSON</li>
<li>Design a function that will extract all metrics for all activities in the JSON</li>
</ul></li>
<li>Have a first cleaning of the data :
<ul>
<li>Check the distance/elevation variables ; what do you think ?</li>
<li>Check the speed related variables : what do you think ?</li>
<li>Check the calories variable and adjust it</li>
<li>Check the duration related variable and adjust them to have minutes</li>
<li>To help you figuring out, you can check an activity on garmin’s site using <a href="https://connect.garmin.com/modern/activity/5570974040">this url</a> and change the activity number for the one you are inspecting</li>
</ul></li>
</ul>
<p>A lot of reverse engineering ahead</p>
</div>
<div id="one-tool-you-will-need-lapply" class="section level3">
<h3><span class="header-section-number">4.3.2</span> One tool you will need : <code>lapply()</code></h3>
<p>JSON are lists, and to iterate over list elements, you can either use <code>for</code> loops, which is highly <em>not recommended</em> (R is no good with loops), or use <code>lapply()</code>. This function applies an operation over all elements of a list (or vector) and returns a list containing the result. You can also use <code>sapply()</code> which tries to coerce the result to a vector (if possible) if the expected output is not a list.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="manip.html#cb104-1"></a>random_list &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>,<span class="cf">function</span>(xx) <span class="kw">rnorm</span>(<span class="dv">100</span>,xx,xx<span class="op">/</span><span class="dv">5</span>))</span>
<span id="cb104-2"><a href="manip.html#cb104-2"></a><span class="kw">str</span>(random_list[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>])</span></code></pre></div>
<pre><code>## List of 5
##  $ : num [1:100] 0.944 1.183 1.093 0.928 0.754 ...
##  $ : num [1:100] 2.68 2.3 1.77 2.12 2.07 ...
##  $ : num [1:100] 4.05 2.54 4.76 3.83 2.79 ...
##  $ : num [1:100] 4.4 4.42 4.65 3.6 4.48 ...
##  $ : num [1:100] 5.9 4.62 5.83 6.25 5.82 ...</code></pre>
<p><strong>Attention :</strong> be careful with the squared brackets</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="manip.html#cb106-1"></a>random_list[<span class="dv">1</span>] <span class="co"># is a list</span></span></code></pre></div>
<pre><code>## [[1]]
##   [1] 0.9436880 1.1831262 1.0925724 0.9280188 0.7540469 0.9104209 0.8712381
##   [8] 0.9704622 1.0341959 0.8505307 0.8451915 0.8265596 0.9910725 0.8276541
##  [15] 1.1416869 1.3554439 0.8770533 0.8934530 0.5983482 1.1486400 1.1270992
##  [22] 0.9776215 1.1796192 0.9405892 1.0088531 0.7025829 0.5881996 1.3322965
##  [29] 0.9360755 1.0658787 1.1266269 0.9540235 0.7489310 0.8694687 1.2280474
##  [36] 1.2087421 1.0449005 1.3480429 0.8021613 1.3107555 0.8493253 0.9014136
##  [43] 0.7113485 1.3169345 1.0737419 0.9787257 1.1642485 0.5714994 1.1188988
##  [50] 1.4262235 1.1007646 1.0715430 1.0299048 0.8500849 0.8922556 1.0105037
##  [57] 0.9473563 0.7583478 0.4443807 0.9510481 1.1715465 1.0068420 1.4001446
##  [64] 0.8123661 1.3846631 1.3299469 1.4670911 0.5322030 1.1211732 1.0770184
##  [71] 0.8741614 1.0802569 0.9200197 0.7028054 0.8608827 1.1757180 1.0645214
##  [78] 1.1666853 1.3398172 0.6935351 1.0937889 0.8936660 0.8756284 0.9336252
##  [85] 1.1585959 0.7589066 1.2015276 0.8559701 1.3121365 1.0196669 1.1283086
##  [92] 1.0126564 0.9858663 1.0507537 0.9218198 0.9830380 1.0204346 0.6423202
##  [99] 0.9263616 1.0201048</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="manip.html#cb108-1"></a>random_list[[<span class="dv">1</span>]] <span class="co"># is a vector</span></span></code></pre></div>
<pre><code>##   [1] 0.9436880 1.1831262 1.0925724 0.9280188 0.7540469 0.9104209 0.8712381
##   [8] 0.9704622 1.0341959 0.8505307 0.8451915 0.8265596 0.9910725 0.8276541
##  [15] 1.1416869 1.3554439 0.8770533 0.8934530 0.5983482 1.1486400 1.1270992
##  [22] 0.9776215 1.1796192 0.9405892 1.0088531 0.7025829 0.5881996 1.3322965
##  [29] 0.9360755 1.0658787 1.1266269 0.9540235 0.7489310 0.8694687 1.2280474
##  [36] 1.2087421 1.0449005 1.3480429 0.8021613 1.3107555 0.8493253 0.9014136
##  [43] 0.7113485 1.3169345 1.0737419 0.9787257 1.1642485 0.5714994 1.1188988
##  [50] 1.4262235 1.1007646 1.0715430 1.0299048 0.8500849 0.8922556 1.0105037
##  [57] 0.9473563 0.7583478 0.4443807 0.9510481 1.1715465 1.0068420 1.4001446
##  [64] 0.8123661 1.3846631 1.3299469 1.4670911 0.5322030 1.1211732 1.0770184
##  [71] 0.8741614 1.0802569 0.9200197 0.7028054 0.8608827 1.1757180 1.0645214
##  [78] 1.1666853 1.3398172 0.6935351 1.0937889 0.8936660 0.8756284 0.9336252
##  [85] 1.1585959 0.7589066 1.2015276 0.8559701 1.3121365 1.0196669 1.1283086
##  [92] 1.0126564 0.9858663 1.0507537 0.9218198 0.9830380 1.0204346 0.6423202
##  [99] 0.9263616 1.0201048</code></pre>
<!-- ## The split-apply-combine operation -->
<!-- ![](img/split-apply-combine.png) -->
</div>
</div>
<div id="tidy-your-data" class="section level2">
<h2><span class="header-section-number">4.4</span> Tidy your data</h2>
<p>The data will almost never come in a ready-to-use format. Wrangling the data, beyond <em>cleaning</em> it also sometimes imply to <em>reshape</em> it so that it conforms to the tidy principles. For that you have 2 functions :</p>
<ul>
<li><code>pivot_longer()</code> which will convert columns into rows</li>
<li><code>pivot_wider()</code>, the reciprocate operation, which will convert rows into columns</li>
</ul>
<p>For example, we can chose that an observation is the combination of an activity and a metric. This representation can be useful in some cases (see <a href="multivar.html#multivar">6</a>).</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="manip.html#cb110-1"></a>dat_long &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-2"><a href="manip.html#cb110-2"></a><span class="st">  </span><span class="kw">select</span>(activityId,<span class="kw">where</span>(is.numeric)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-3"><a href="manip.html#cb110-3"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>activityId,<span class="dt">names_to=</span><span class="st">&quot;metric&quot;</span>,<span class="dt">values_to=</span><span class="st">&quot;value&quot;</span>)</span>
<span id="cb110-4"><a href="manip.html#cb110-4"></a>dat_long</span></code></pre></div>
<pre><code>## # A tibble: 363,924 x 3
##    activityId metric             value
##    &lt;chr&gt;      &lt;chr&gt;              &lt;dbl&gt;
##  1 5570974040 beginTimestamp  1.60e+12
##  2 5570974040 startTimeGmt    1.60e+12
##  3 5570974040 startTimeLocal  1.60e+12
##  4 5570974040 duration        3.64e+ 6
##  5 5570974040 distance        3.00e+ 5
##  6 5570974040 elevationGain  NA       
##  7 5570974040 elevationLoss  NA       
##  8 5570974040 avgSpeed        9.86e- 2
##  9 5570974040 maxSpeed        1.12e- 1
## 10 5570974040 avgHr          NA       
## # … with 363,914 more rows</code></pre>
<p>With this format you can get summary statistics for all metrics also easily :</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="manip.html#cb112-1"></a><span class="kw">group_by</span>(dat_long,metric) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb112-2"><a href="manip.html#cb112-2"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_val=</span><span class="kw">mean</span>(value,<span class="dt">na.rm=</span>T))</span></code></pre></div>
<pre><code>## # A tibble: 66 x 2
##    metric                  mean_val
##    &lt;chr&gt;                      &lt;dbl&gt;
##  1 activeLengths            61.8   
##  2 activeSets                0     
##  3 aerobicTrainingEffect     2.88  
##  4 anaerobicTrainingEffect   0.298 
##  5 avgBikeCadence           91.2   
##  6 avgDepth                  0     
##  7 avgDoubleCadence        162.    
##  8 avgFractionalCadence      0.0696
##  9 avgGroundContactBalance  49.4   
## 10 avgGroundContactTime    252.    
## # … with 56 more rows</code></pre>
<p>And you you can go back to the original format if you want :</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="manip.html#cb114-1"></a><span class="kw">group_by</span>(dat_long,metric) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb114-2"><a href="manip.html#cb114-2"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_val=</span><span class="kw">mean</span>(value,<span class="dt">na.rm=</span>T)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb114-3"><a href="manip.html#cb114-3"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> metric,<span class="dt">values_from=</span>mean_val)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 66
##   activeLengths activeSets aerobicTraining… anaerobicTraini… avgBikeCadence
##           &lt;dbl&gt;      &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;
## 1          61.8          0             2.88            0.298           91.2
## # … with 61 more variables: avgDepth &lt;dbl&gt;, avgDoubleCadence &lt;dbl&gt;,
## #   avgFractionalCadence &lt;dbl&gt;, avgGroundContactBalance &lt;dbl&gt;,
## #   avgGroundContactTime &lt;dbl&gt;, avgHr &lt;dbl&gt;, avgLeftBalance &lt;dbl&gt;,
## #   avgPower &lt;dbl&gt;, avgRightBalance &lt;dbl&gt;, avgSpeed &lt;dbl&gt;,
## #   avgStrokeDistance &lt;dbl&gt;, avgStrokes &lt;dbl&gt;, avgSwimCadence &lt;dbl&gt;,
## #   avgSwolf &lt;dbl&gt;, avgVerticalOscillation &lt;dbl&gt;, avgVerticalRatio &lt;dbl&gt;,
## #   avgVerticalSpeed &lt;dbl&gt;, beginTimestamp &lt;dbl&gt;, bottomTime &lt;dbl&gt;,
## #   calories &lt;dbl&gt;, distance &lt;dbl&gt;, duration &lt;dbl&gt;, elapsedDuration &lt;dbl&gt;,
## #   elevationGain &lt;dbl&gt;, elevationLoss &lt;dbl&gt;, endLatitude &lt;dbl&gt;,
## #   endLongitude &lt;dbl&gt;, floorsDescended &lt;dbl&gt;, intensityFactor &lt;dbl&gt;,
## #   lactateThresholdBpm &lt;dbl&gt;, lactateThresholdSpeed &lt;dbl&gt;, lapCount &lt;dbl&gt;,
## #   max20MinPower &lt;dbl&gt;, maxBikeCadence &lt;dbl&gt;, maxDepth &lt;dbl&gt;,
## #   maxDoubleCadence &lt;dbl&gt;, maxElevation &lt;dbl&gt;, maxFractionalCadence &lt;dbl&gt;,
## #   maxFtp &lt;dbl&gt;, maxHr &lt;dbl&gt;, maxRunCadence &lt;dbl&gt;, maxSpeed &lt;dbl&gt;,
## #   maxSwimCadence &lt;dbl&gt;, maxTemperature &lt;dbl&gt;, maxVerticalSpeed &lt;dbl&gt;,
## #   minElevation &lt;dbl&gt;, minTemperature &lt;dbl&gt;, movingDuration &lt;dbl&gt;,
## #   normPower &lt;dbl&gt;, poolLength &lt;dbl&gt;, startLatitude &lt;dbl&gt;,
## #   startLongitude &lt;dbl&gt;, startTimeGmt &lt;dbl&gt;, startTimeLocal &lt;dbl&gt;,
## #   steps &lt;dbl&gt;, strokes &lt;dbl&gt;, surfaceInterval &lt;dbl&gt;, totalReps &lt;dbl&gt;,
## #   totalSets &lt;dbl&gt;, trainingStressScore &lt;dbl&gt;, vO2MaxValue &lt;dbl&gt;</code></pre>
<p>The result looks very much like the one we had with <code>across</code> but the intermediate manipulationsncan be very useful in some cases. For instance, you could join the <code>dat_long</code> dataframe or its summary with an external data that has values by metrics (eg the average metric values for pro athletes).</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="stats.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["DataExploration.pdf", "DataExploration.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
